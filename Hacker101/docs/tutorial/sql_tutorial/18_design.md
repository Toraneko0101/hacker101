# クイズ(18:DB設計)

## Q184 システム開発の工程と諸問題について知っていますか?

??? success
    ### 大まかな分類

    ```text
    1 要件定義
      ・システムが満たす機能
      ・サービスの水準などを決定
    
    2 設計(基本設計&詳細設計)
      ・要件を満たすための設計を行う
    
    3 開発
      ・設計に従い、システムを実装

    4 テスト(単体テスト&結合テスト&総合テスト)
      ・システムが実用に耐えるか試験を行う
    ```

    ### 設計モデル

    ```text
    ウォーターフォール
      ・上記の工程を1つずつ踏んでいく
      ・工程が逆戻りすることはないという
        モデルを提唱した方ですら肯定していない「神話」がある
      ・未来予知ができるなら採用すべき
    
    プロトタイピングモデル
      ・試作品を作る⇒フィーバックを繰り返す
      ・小規模のシステムに適用される
      ・仕様変更を繰り返すとコストが増える
    
    アジャイル開発
      ・Web系などで多い
      ・上記工程を繰り返す
      ・仕様変更や切り戻しはしやすい
      ・納期通りに仕上がるとは限らない
      ・方向がぶれないように会議を入れた結果、会議だらけに
    ```

    ### 設計モデルを変えれば幸せになれるのか

    ??? info
        ### 問題は別の箇所にありそう

        ```text
        A. 納期や予算を神聖視するのが原因なのでは？

        [納期や予算を神聖視した場合]
          ・8割がた終わっています（嘘だよ、実際は1割だよ）
          ・ミスや失敗を隠す（テストを捻じ曲げたり）
          ・クラウドや協力会社が悪いと言い出す
          ・で、最終的にどうしようもなくなって遅延する
          ・後進の指導もしなくなるだろう。
            遅れたら自分が不利益を受けるのだから
        
        ⇒これは本人の気質ではなく、失敗を責める風土にある
          (責めている人が善意＝目標を心から達成しようと
          しているというのが一番問題)
        
        Q. でも、期日までに終わるって言ったじゃん！
        A. 無理な目標を言わなければならない風土があるのでは？
           最悪の場合、1カ月。最短だと3日で終わる場合、
           1か月の方を報告できる人が多いとは思えない。
           丁寧に理由を説明しても、こんなにかかるの？
           と聞く耳持たれなさそうだ。
           間を取った結果、案の定遅延する未来が見える。
        
        Q. 理想の納期(≠全力疾走の結果)
        A. マラソンですら2時間なのだから、
           長期の目標を立てるならmarginは必要
           一度も理想の納期で達成していないならそもそも
           目標が現実に即していない。
           現実的な納期を理想とし、これに加えて想定外の事態
           に関するmarginを考えないと、最初から遅延が
           決定していることになる。
           
        
        [成果主義は難しい]
          ・例えば、目標の達成度合いに合わせて
          　ボーナスを支給する制度を考える
            ⇒未達を恐れて、社員の目標は下がる
            ⇒チャレンジしなくなる（成長しにくくなる）
            ⇒従来の技術を使い続け、成長しなくなる
        
        [連帯責任は問題外だし.....]
          ・成果主義で責任を明確にした場合助け合うだろうか?
          ・役割は決めるが、問題が起きた場合は全員で取り組む
          ・言葉でいうのは簡単だが、ギスギスしそう
          ・軍隊以外採用してはいけないだろう
        
        [他者を助けることを評価に反映するとか?]
          ・あくまでも加点方式で
          ・でも財源は有限だし......、どうしても相対的になる

        [未来に投資してみる?]
          ・業務時間内に勉強させる
          ・商品に（言い方が悪いが）欠陥があった場合、
            会社は直そうと努力するだろう。科学的な方法で
          ・それなら想定の納期に間に合わなかった場合、
            会社は欠陥があるとして、修正を試みるべきでは？
          ・IT業界は、社員のスキルが商品なのだから
            会社はそれを改善させていくべきだ
          ・必要な指導を施していないなら、
            商品の性能が向上しないのは当たり前では?
          
          ⇒でも、再教育って何？　具体的にどうすれば?
          ⇒一人ひとりに教育している時間はないよ！
        
        [ところで]
          ・本来、知見は評価されるべき
          ・1日かけて失敗したとしても、その内容を取りまとめ
            Documentとして残した場合、それは技術資産だろう
          ⇒昨日の進捗はありませんでした、ではないはずだ

        
        [結論]
        Q. で、何が言いたいのか。
        A. 開発手法を変えても問題は解決しない。

        Q. 何を変えればいいのだろう?
        A. 成果主義とか? でも年功序列もなあ
           (1 ハイリスクハイリターンで、挑戦する人は少ない)
           (2 挑戦意欲の高い提案を周囲がつぶすようになる)
           (3 会社全体に保守思想が蔓延する)
           (4 会社は右肩下がりで衰退する)
          
        [個人的な解決法]
          ・タスクを抱え込むのは、ひいては納期直前に
            問題が発覚しプロジェクトが炎上するのは、
            業務が属人化しているのが原因といえる

          ・同じ部署ならまだしも、異なる部署の
            PGやSEが毎日何を行っているのか、
            何で苦しんでいるのか知らない人間も多そう

          ・別に国家機密を扱っているわけではないのだから
            同僚間で、知識の分断を行うのは損なのでは？

          ・機密事項に問題のない範囲で、知っている情報を
          　すべて吐いてもらいたいというのが本音。
            知っていれば引継ぎの負荷も下がるだろうし
          
          ⇒たとえばGithubのissueやWikiを使うのは?

            有料アカウント(owner)を1つ作り、
            社員をコントリビュータとして招待。

            問題があれば(勿論機密情報を一般化した上で)
            issue等で質問。手が空いたものが答えてくれるという
            寸法だ。実際に回答がくるかは別として、
            見て見ぬふりをさせないのが肝要だといえる。

            (実際、何週間も同じissueが開いていて、
            誰も返信していなかったら、それは
            進まなくても問題ないと黙認しているのと同じ)

            得た知識についてはWiki等で公開
            この知識にはマネジメントなどの分野も含まれる
            会社法などについてもあると嬉しい
            業務報告会で他ごとになるのは避けられそうだ

            ※回答したか否かを成果指標に含めるのは
              やめにしてもらいたい。新たなタスクが増える
              だけだと労働者からの反発がくる。
          
            ⇒もちろん、個々に技術ブログなどを作成し、
              共有するのでもいいが、分散しそうだ。
              ところで、このmkdocsの場合、giscusを使うことで
              discussionsとの連携ができたはず
          
        
        [機密情報の一般化とは?]
          ・stackOverflow等で聞いても問題ないような
            形にする
          
          ・匿名化があるとより良い。
            上下関係を持ち込まれると、発言しなくなる
            あくまでもコミュニティのような形にしたい
            極論、辞めた人間でも留まれるような
            成果指標に含めないなら問題ないだろう
          (※githubでprojectについて議論したいなら話は別)

          ・たとえばDBの速度に問題が発生しているとき、
            コードをそのまま貼り付けるのはやめる。

          ・試したことや、発生している問題や、エラーコード、
            実際のToolやフレームワークや依存技術
          ⇒これらを貼ることで、他の解決策や
            落とし穴にはまっていることを提示してくれるかも
        
        [自分の技術をWikiで公開するメリットは?]
          ・完璧な人ならないが
          　大体、知識というのは不完全
          　誤解等も多分にある

          ・この学習記録についてもそうで、
            出来れば多くの人に誤っている点を教えてもらいたい

          ・それに、誰かに説明することで
            自分の知識が深まるというのはよくある話

          ・伝わらない言い方でしか、伝えられないなら
            それは自分の知識が足りない証拠だろうし

          ・それらしい言葉を使って枝葉をごまかしていないか、
            小学生にもわかる言葉で説明できるのか、
            自分の理解度を深めることにもつながるはず
        ```

## Q185 設計工程とDBの関係性について知っていますか?

??? success
    ### 設計工程は小分類に分けられる

    ```text
    ・AP設計、UI設計、DB設計など...
    ```

    ### DOA

    ```text
    Data Oriented Approach: データ中心設計
      ・プログラムよりも前にデータの設計から始める
    ```

    ### POA

    ```text
    Process Oriented Approach:プロセス中心設計
      ・プログラミングがデータ設計の前に来る
    ```

    ### DOAはPOAよりまし

    ```text
    ・プログラムの度に、異なるDBを用意していると冗長的
    ・プログラムは変化しやすいので、プログラムに合わせた
      設計を行うより、取得方法を変えた方が無難
    ・先にデータを作成しておけば、複数プログラムから利用可能
    ```

    ### 再利用と注意点

    ```text
    1 例えば在庫関連のDBがあり、これを2つのシステムで
      使用しているとする

    2 ここで片方のシステムで大きな変更があり、
      DB定義の変更を行った
    
    3 もう片方のシステムが動かなくなった

    問題点
      ・共通DBの共通Tableを使用していたこと
      ・基本となるTableをもとに、それぞれに対して
        Viewを作成していれば、問題は避けられた
        (そもそもDBがSPOFになるためやるなというのはご愛敬)
    ```

## Q186 3層スキーマについて知っていますか?

??? success
    ### スキーマ(データ構造)は3つのレベルに分けられる

    ```text
    1 外部スキーマ = View
    2 概念スキーマ = Table
    3 内部スキーマ = File
    ```

    ### 外部スキーマ

    ```text
    ・ユーザ目線の構造(ユーザから見たDB)
    ・ユーザからはViewやTableの区別がつかない
    ```

    ### 概念スキーマ

    ```text
    ・DBに保持するdataの中身,data同士の関係性を記述したもの
    ・開発者から見たDB
    ```

    ### 内部スキーマ

    ```text
    ・概念スキーマを、実際にDBMSがどのように格納しているか
    ・DBMSから見たDB
    ・テーブルやindexの物理的な仕組みなどはこれに当たる
    ```

    ### なぜ3層に分かれているのか
    ```text
    内部スキーマ & 外部スキーマしかない場合
      ・Viewを内部スキーマをもとに作成することになる
      ⇒これは難易度が高い(基本となるTableがあった方がいい)
    
    内部スキーマ & 概念スキーマしかない場合
      ・システムの変更の際に、毎回テーブルを構築する必要あり
      ⇒外部スキーマがあれば、格納するデータを変更せずに済む
    
    複雑さを隠ぺいするためと考えてもいい
      ・通常の利用者は、DBの仕組みなんぞ知りたくもない
      ・通常の開発者は、DBMSの挙動を知りたいとは考えない
      ⇒だから、概念スキーマと外部スキーマで隠蔽してもらう
    ```

## Q187 論理設計のステップについて知っていますか?

??? success
    ### 用語について

    ```text
    論理設計：概念スキーマの設計
    物理設計：内部スキーマの設計
    ```

    ### 物理設計より先に行う理由

    ```text
    ・「論理」とは、CPUやメモリ、ストレージなどの
      物理層の制約に依存しないことを意味する
    
    ・そもそも実現したいことがあり、DBを使用するのだから、
    　物理層の制約に囚われる前に、要件を書きだした方がいい
    
    ・ただし、予算や性能の関係で、物理設計の段階で
      論理設計の見直しを強いられることはしばしば
    
    ※概念設計、論理設計、物理設計と分けることもある。
      (というよりこちらの方が一般的な気もする
      基本情報の過去問なんかを見ていると。後述
      https://gihyo.jp/dev/feature/01/database/0001)
      言葉の定義よりも、物理設計が先に来ないことの方が重要
    ```

    ### 論理設計のステップについて

    ```text
    1 エンティティの抽出
    2 エンティティの定義
    3 正規化
    4 ER図の作成
    ```

    !!! warning
        ### 概念設計を考える場合

        ```text
        1 エンティティの抽出
        2 エンティティの定義
        3 ER図（概念データモデル）を作成
        4 ER図をRDBに適した表に機械的に変換
        5 正規化
        6 ER図の作成(論理データモデル)
        ```

